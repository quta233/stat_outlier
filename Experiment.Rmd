---
title: "Experiment Procedure"
author: "Alex Khater"
date: "1/15/2020"
output: html_document
---
```{r}
library(Stat2Data)
library(mosaic)
library(car)
library(outliers)
library(tidyverse)
```



```{r}
chi_square <- function(x, pvalue) {
  while(chisq.out.test(x)$p.value < pvalue) {
    str <- chisq.out.test(x)$alternative
    print(str)
    n <- as.numeric(unlist(regmatches(str,
                                    gregexpr("(?<=value)(.*)(?=is an outlier)", str, perl = T))))
    x <- x[x != n]
    print(length(x))
  }
}
```

```{r}
cook_distance <- function(lm) {
  cooksd <- cooks.distance(lm)
  k <- 4*mean(cooksd)
  data <- data.frame(id=as.character(1:length(cooksd)), 
                  value=cooksd, 
                  stringsAsFactors=F)
  data %>%
    mutate(id = seq.int(nrow(data))) %>%
    mutate(outlier = if_else(value >= k, "yes", "no")) %>%
    filter(outlier == "yes")
}
```


```{r}
IQR_test <- function(data, num, v) {
  str <- unname(quantile(num, probs = c(0.25, 0.75), na.rm = TRUE)[c("25%", "75%")])
  iqr <- str[2] - str[1]
  q1 <- str[1] - iqr
  q3 <- str[2] + iqr
  data %>%
    mutate(id = seq.int(nrow(data))) %>%
    select(id, v) %>%
    rename("value" = v) %>%
    mutate(outlier = if_else(value >= q3 | value <= q1, "yes", "no")) %>%
    filter(outlier == "yes")
}
```

```{r}
sd_test <- function(data, num, v) {
  t1 <- mean(num) + 4*sd(num)
  t2 <- mean(num) - 4*sd(num)
  data %>%
    mutate(id = seq.int(nrow(data))) %>%
    select(id, v) %>%
    rename("value" = v) %>%
    mutate(outlier = if_else(value >= t1 | value <= t2, "yes", "no")) %>%
    filter(outlier == "yes")
}
```

```{r}
#Bonferonni
car::outlierTest(LM)
```

Begin Work:

Data1 :
```{r}
chi_square(nfl_1$elo1_post, 0.05)
cook_distance(D1)
IQR_test(nfl_1, nfl_1$elo1_post, "elo1_post")
sd_test(nfl_1, nfl_1$elo1_post, "elo1_post")
```


```{r}
cooksd <- cooks.distance(D1)
cooksd
```









